<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹¤ì‹œê°„ í™˜ì „ Â· USDT ê±°ë˜ - í¬ë¡œìŠ¤ë³´ë”</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <style>
      :root {
        --color-primary: #0F172A;
        --color-secondary: #1E293B;
        --color-accent: #FF7A00;
        --color-success: #10B981;
        --color-warning: #F59E0B;
      }
      
      body {
        font-family: 'Inter', 'Noto Sans KR', sans-serif;
        font-size: 14px;
      }
      
      .single-line {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      
      .exchange-card {
        background: white;
        border-radius: 16px;
        box-shadow: 0 4px 16px rgba(0,0,0,0.08);
      }
      
      .currency-select {
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%23666' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3E%3C/svg%3E");
        background-position: right 0.5rem center;
        background-repeat: no-repeat;
        background-size: 1.5em 1.5em;
        padding-right: 2.5rem;
      }
      
      .swap-button {
        transition: transform 0.3s ease;
      }
      
      .swap-button:hover {
        transform: rotate(180deg);
      }
      
      .rate-badge {
        display: inline-flex;
        align-items: center;
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 11px;
        font-weight: 600;
        transition: transform 0.2s ease;
      }
      
      .pulse-dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: var(--color-success);
        animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      }
      
      @keyframes pulse {
        0%, 100% {
          opacity: 1;
        }
        50% {
          opacity: .5;
        }
      }
      
      .network-option {
        border: 2px solid #E5E7EB;
        border-radius: 8px;
        padding: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      
      .network-option:hover {
        border-color: var(--color-accent);
        background: #FFF7ED;
      }
      
      .network-option.selected {
        border-color: var(--color-accent);
        background: #FFF7ED;
      }
      
      .info-box {
        background: #F8FAFC;
        border-left: 4px solid var(--color-accent);
        padding: 12px;
        border-radius: 4px;
        font-size: 13px;
      }
      
      @media (max-width: 767px) {
        .exchange-card {
          border-radius: 12px;
        }
      }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-gradient-to-r from-slate-900 to-slate-800 text-white py-3 sticky top-0 z-50 shadow-md">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-2">
                    <i class="fas fa-exchange-alt text-xl text-orange-400"></i>
                    <h1 class="text-lg font-bold" id="headerTitle">í¬ë¡œìŠ¤ë³´ë”</h1>
                </div>
                <div class="flex items-center space-x-2">
                    <i class="fas fa-globe text-sm"></i>
                    <select id="globalLang" class="bg-slate-700 text-white px-3 py-1 rounded text-sm cursor-pointer border border-slate-600">
                        <option value="ko">í•œêµ­ì–´</option>
                        <option value="en">English</option>
                        <option value="zh">ä¸­æ–‡</option>
                    </select>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Exchange Section -->
    <section class="py-6 md:py-8">
        <div class="container mx-auto px-4 max-w-2xl">
            <!-- Title & Real-time Badge -->
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl md:text-2xl font-bold text-gray-800" id="exchangeTitle">ì‹¤ì‹œê°„ í™˜ì „ Â· USDT ê±°ë˜</h2>
                <div class="flex items-center space-x-2 rate-badge bg-green-100 text-green-800">
                    <div class="pulse-dot"></div>
                    <span id="liveLabel">LIVE</span>
                </div>
            </div>

            <!-- Exchange Card -->
            <div class="exchange-card p-4 md:p-6 mb-4">
                <!-- From Amount -->
                <div class="mb-4">
                    <label class="block text-gray-700 font-semibold mb-2 text-sm" id="sendAmountLabel">ë³´ë‚¼ ê¸ˆì•¡</label>
                    <div class="flex space-x-2">
                        <input 
                            type="number" 
                            id="fromAmount" 
                            class="flex-1 px-3 py-3 text-base border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent" 
                            placeholder="1,000,000"
                            value="1000000"
                            min="0">
                        <select id="fromCurrency" class="currency-select px-4 py-3 text-base font-semibold border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent min-w-[100px]">
                            <option value="KRW">KRW</option>
                            <option value="CNY">CNY</option>
                            <option value="USD">USD</option>
                            <option value="USDT">USDT</option>
                        </select>
                    </div>
                </div>

                <!-- Swap Button -->
                <div class="flex justify-center my-2">
                    <button onclick="swapCurrencies()" class="swap-button bg-orange-500 hover:bg-orange-600 text-white w-10 h-10 rounded-full flex items-center justify-center">
                        <i class="fas fa-exchange-alt"></i>
                    </button>
                </div>

                <!-- To Currency -->
                <div class="mb-4">
                    <label class="block text-gray-700 font-semibold mb-2 text-sm" id="receiveCurrencyLabel">ë°›ì„ í†µí™”</label>
                    <select id="toCurrency" class="currency-select w-full px-4 py-3 text-base font-semibold border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent">
                        <option value="USD" data-ko="USD (ë‹¬ëŸ¬)" data-en="USD (Dollar)" data-zh="USD (ç¾å…ƒ)">USD (ë‹¬ëŸ¬)</option>
                        <option value="USDT" data-ko="USDT (í…Œë”)" data-en="USDT (Tether)" data-zh="USDT (æ³°è¾¾å¸)">USDT (í…Œë”)</option>
                        <option value="KRW" data-ko="KRW (ì›í™”)" data-en="KRW (Won)" data-zh="KRW (éŸ©å…ƒ)">KRW (ì›í™”)</option>
                        <option value="CNY" data-ko="CNY (ìœ„ì•ˆí™”)" data-en="CNY (Yuan)" data-zh="CNY (äººæ°‘å¸)">CNY (ìœ„ì•ˆí™”)</option>
                    </select>
                </div>

                <!-- USDT Network Selection -->
                <div id="networkSection" class="mb-4 hidden">
                    <label class="block text-gray-700 font-semibold mb-2 text-sm" id="networkLabel">ë„¤íŠ¸ì›Œí¬ ì„ íƒ</label>
                    <div class="grid grid-cols-3 gap-2">
                        <div class="network-option selected" onclick="selectNetwork('TRC20')" data-network="TRC20">
                            <div class="font-semibold text-sm mb-1">TRC20</div>
                            <div class="text-xs text-gray-600">~$1.5</div>
                            <div class="text-xs text-green-600 mt-1" id="network1Label">ê¶Œì¥</div>
                        </div>
                        <div class="network-option" onclick="selectNetwork('BEP20')" data-network="BEP20">
                            <div class="font-semibold text-sm mb-1">BEP20</div>
                            <div class="text-xs text-gray-600">~$0.5</div>
                            <div class="text-xs text-gray-600 mt-1" id="network2Label">ì €ë ´</div>
                        </div>
                        <div class="network-option" onclick="selectNetwork('ERC20')" data-network="ERC20">
                            <div class="font-semibold text-sm mb-1">ERC20</div>
                            <div class="text-xs text-gray-600">~$15</div>
                            <div class="text-xs text-orange-600 mt-1" id="network3Label">ê³ ê°€</div>
                        </div>
                    </div>
                </div>

                <!-- Rate Info -->
                <div class="bg-gray-50 rounded-lg p-4 mb-4" id="rateInfo">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-xs text-gray-600" id="rateLabel">í™˜ìœ¨</span>
                        <span class="font-semibold text-sm" id="rateValue">1,345.20</span>
                    </div>
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-xs text-gray-600" id="feeLabel">ìˆ˜ìˆ˜ë£Œ (0.8% + 0.2%)</span>
                        <span class="font-semibold text-sm text-orange-600" id="feeValue">10,000 KRW</span>
                    </div>
                    <div id="networkFeeRow" class="flex items-center justify-between mb-2 hidden">
                        <span class="text-xs text-gray-600" id="networkFeeLabel">ë„¤íŠ¸ì›Œí¬ ìˆ˜ìˆ˜ë£Œ</span>
                        <span class="font-semibold text-sm text-orange-600" id="networkFeeValue">~$1.5</span>
                    </div>
                    <div class="border-t border-gray-300 pt-2 mt-2">
                        <div class="flex items-center justify-between">
                            <span class="font-bold text-sm text-gray-800" id="receiveLabel">ì‹¤ìˆ˜ë ¹ ê¸ˆì•¡</span>
                            <span class="font-bold text-lg text-green-600" id="receiveValue">742.30 USD</span>
                        </div>
                    </div>
                </div>

                <!-- Limits Info -->
                <div class="info-box mb-4" id="limitsInfo">
                    <div class="flex items-start space-x-2">
                        <i class="fas fa-info-circle text-orange-500 mt-0.5"></i>
                        <div class="flex-1 text-xs">
                            <div id="limitsText">ê±°ë˜ í•œë„: ìµœì†Œ 10,000 KRW ~ ìµœëŒ€ 10,000,000 KRW (ì¼ì¼ 50,000,000 KRW)</div>
                        </div>
                    </div>
                </div>

                <!-- Last Update -->
                <div class="flex items-center justify-between text-xs text-gray-500 mb-4">
                    <span id="lastUpdateLabel">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸</span>
                    <span id="lastUpdateTime">--</span>
                </div>

                <!-- Action Button -->
                <button onclick="showConfirmation()" class="w-full bg-orange-500 hover:bg-orange-600 text-white py-3 rounded-lg font-bold text-base transition">
                    <span id="actionButton">ì§€ê¸ˆ ê±°ë˜í•˜ê¸°</span>
                </button>

                <!-- Regulation Notice -->
                <div class="mt-3 text-xs text-gray-500 text-center" id="regulationNotice">
                    ë³¸ í”Œë«í¼ì€ í•œêµ­Â·ì¤‘êµ­ ê·œì œ ê¸°ì¤€ì„ ìë™ ì ìš©í•©ë‹ˆë‹¤
                </div>
            </div>

            <!-- Quick Scenarios -->
            <div class="grid grid-cols-2 gap-2 mb-6">
                <button onclick="quickScenario('KRW', 'USD')" class="bg-white border-2 border-gray-200 hover:border-orange-500 rounded-lg p-3 text-left transition">
                    <div class="text-2xl mb-2">ğŸ’µ</div>
                    <div class="font-semibold text-sm mb-1">KRW â†’ USD</div>
                    <div class="text-xs text-gray-600" id="scenario1Desc">ì›í™”ë¥¼ ë‹¬ëŸ¬ë¡œ</div>
                </button>
                <button onclick="quickScenario('CNY', 'USD')" class="bg-white border-2 border-gray-200 hover:border-orange-500 rounded-lg p-3 text-left transition">
                    <div class="text-2xl mb-2">ğŸ’´</div>
                    <div class="font-semibold text-sm mb-1">CNY â†’ USD</div>
                    <div class="text-xs text-gray-600" id="scenario2Desc">ìœ„ì•ˆì„ ë‹¬ëŸ¬ë¡œ</div>
                </button>
                <button onclick="quickScenario('KRW', 'USDT')" class="bg-white border-2 border-gray-200 hover:border-orange-500 rounded-lg p-3 text-left transition">
                    <div class="text-2xl mb-2">ğŸ’</div>
                    <div class="font-semibold text-sm mb-1">KRW â†’ USDT</div>
                    <div class="text-xs text-gray-600" id="scenario3Desc">ì›í™”ë¥¼ í…Œë”ë¡œ</div>
                </button>
                <button onclick="quickScenario('CNY', 'USDT')" class="bg-white border-2 border-gray-200 hover:border-orange-500 rounded-lg p-3 text-left transition">
                    <div class="text-2xl mb-2">ğŸª™</div>
                    <div class="font-semibold text-sm mb-1">CNY â†’ USDT</div>
                    <div class="text-xs text-gray-600" id="scenario4Desc">ìœ„ì•ˆì„ í…Œë”ë¡œ</div>
                </button>
            </div>

            <!-- Rate Source -->
            <div class="text-center text-xs text-gray-500 mb-4">
                <span id="rateSource">í™˜ìœ¨ ì¶œì²˜: ì‹¤ì‹œê°„ êµ­ì œ ê¸ˆìœµì‹œì¥ ë°ì´í„°</span>
            </div>
        </div>
    </section>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl max-w-md w-full p-6">
            <div class="text-center mb-4">
                <div class="w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-check-circle text-orange-500 text-3xl"></i>
                </div>
                <h3 class="text-xl font-bold mb-2" id="confirmTitle">ê±°ë˜ ìµœì¢… í™•ì¸</h3>
                <p class="text-sm text-gray-600" id="confirmSubtitle">ì•„ë˜ ë‚´ìš©ì„ í™•ì¸í•´ì£¼ì„¸ìš”</p>
            </div>

            <div class="bg-gray-50 rounded-lg p-4 mb-4">
                <div class="flex justify-between mb-2">
                    <span class="text-sm text-gray-600" id="confirmSendLabel">ë³´ë‚¼ ê¸ˆì•¡</span>
                    <span class="font-semibold" id="confirmSendAmount">1,000,000 KRW</span>
                </div>
                <div class="flex justify-between mb-2">
                    <span class="text-sm text-gray-600" id="confirmReceiveLabel">ë°›ì„ ê¸ˆì•¡</span>
                    <span class="font-bold text-lg text-green-600" id="confirmReceiveAmount">742.30 USD</span>
                </div>
                <div class="flex justify-between mb-2">
                    <span class="text-sm text-gray-600" id="confirmRateLabel">í™˜ìœ¨</span>
                    <span class="text-sm" id="confirmRate">1,345.20</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-sm text-gray-600" id="confirmFeeLabel">ì´ ìˆ˜ìˆ˜ë£Œ</span>
                    <span class="text-sm text-orange-600" id="confirmFee">12,000 KRW</span>
                </div>
            </div>

            <div class="flex space-x-2">
                <button onclick="closeConfirmation()" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 py-3 rounded-lg font-semibold transition">
                    <span id="cancelButton">ì·¨ì†Œ</span>
                </button>
                <button onclick="executeTransaction()" class="flex-1 bg-orange-500 hover:bg-orange-600 text-white py-3 rounded-lg font-semibold transition">
                    <span id="confirmButton">í™•ì¸</span>
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    <script>
      // State
      let selectedNetwork = 'TRC20';
      let currentRates = {};
      let calculationResult = null;

      // Complete Translations
      const translations = {
        ko: {
          headerTitle: 'í¬ë¡œìŠ¤ë³´ë”',
          exchangeTitle: 'ì‹¤ì‹œê°„ í™˜ì „ Â· USDT ê±°ë˜',
          liveLabel: 'LIVE',
          sendAmountLabel: 'ë³´ë‚¼ ê¸ˆì•¡',
          receiveCurrencyLabel: 'ë°›ì„ í†µí™”',
          networkLabel: 'ë„¤íŠ¸ì›Œí¬ ì„ íƒ',
          network1Label: 'ê¶Œì¥',
          network2Label: 'ì €ë ´',
          network3Label: 'ê³ ê°€',
          rateLabel: 'í™˜ìœ¨',
          feeLabel: 'ìˆ˜ìˆ˜ë£Œ (0.8% + 0.2%)',
          networkFeeLabel: 'ë„¤íŠ¸ì›Œí¬ ìˆ˜ìˆ˜ë£Œ',
          receiveLabel: 'ì‹¤ìˆ˜ë ¹ ê¸ˆì•¡',
          lastUpdateLabel: 'ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸',
          actionButton: 'ì§€ê¸ˆ ê±°ë˜í•˜ê¸°',
          regulationNotice: 'ë³¸ í”Œë«í¼ì€ í•œêµ­Â·ì¤‘êµ­ ê·œì œ ê¸°ì¤€ì„ ìë™ ì ìš©í•©ë‹ˆë‹¤',
          scenario1Desc: 'ì›í™”ë¥¼ ë‹¬ëŸ¬ë¡œ',
          scenario2Desc: 'ìœ„ì•ˆì„ ë‹¬ëŸ¬ë¡œ',
          scenario3Desc: 'ì›í™”ë¥¼ í…Œë”ë¡œ',
          scenario4Desc: 'ìœ„ì•ˆì„ í…Œë”ë¡œ',
          rateSource: 'í™˜ìœ¨ ì¶œì²˜: ì‹¤ì‹œê°„ êµ­ì œ ê¸ˆìœµì‹œì¥ ë°ì´í„°',
          confirmTitle: 'ê±°ë˜ ìµœì¢… í™•ì¸',
          confirmSubtitle: 'ì•„ë˜ ë‚´ìš©ì„ í™•ì¸í•´ì£¼ì„¸ìš”',
          confirmSendLabel: 'ë³´ë‚¼ ê¸ˆì•¡',
          confirmReceiveLabel: 'ë°›ì„ ê¸ˆì•¡',
          confirmRateLabel: 'í™˜ìœ¨',
          confirmFeeLabel: 'ì´ ìˆ˜ìˆ˜ë£Œ',
          cancelButton: 'ì·¨ì†Œ',
          confirmButton: 'í™•ì¸'
        },
        en: {
          headerTitle: 'CrossBorder',
          exchangeTitle: 'Real-time Exchange Â· USDT Trading',
          liveLabel: 'LIVE',
          sendAmountLabel: 'Send Amount',
          receiveCurrencyLabel: 'Receive Currency',
          networkLabel: 'Network Selection',
          network1Label: 'Recommended',
          network2Label: 'Cheap',
          network3Label: 'Expensive',
          rateLabel: 'Rate',
          feeLabel: 'Fee (0.8% + 0.2%)',
          networkFeeLabel: 'Network Fee',
          receiveLabel: 'You Receive',
          lastUpdateLabel: 'Last Update',
          actionButton: 'Trade Now',
          regulationNotice: 'KoreaÂ·China regulations automatically applied',
          scenario1Desc: 'Won to Dollar',
          scenario2Desc: 'Yuan to Dollar',
          scenario3Desc: 'Won to Tether',
          scenario4Desc: 'Yuan to Tether',
          rateSource: 'Rate Source: Real-time International Financial Market',
          confirmTitle: 'Confirm Transaction',
          confirmSubtitle: 'Please review the details',
          confirmSendLabel: 'Send Amount',
          confirmReceiveLabel: 'Receive Amount',
          confirmRateLabel: 'Exchange Rate',
          confirmFeeLabel: 'Total Fee',
          cancelButton: 'Cancel',
          confirmButton: 'Confirm'
        },
        zh: {
          headerTitle: 'è·¨å¢ƒæ”¯ä»˜',
          exchangeTitle: 'å®æ—¶å…‘æ¢ Â· USDT äº¤æ˜“',
          liveLabel: 'å®æ—¶',
          sendAmountLabel: 'å‘é€é‡‘é¢',
          receiveCurrencyLabel: 'æ¥æ”¶è´§å¸',
          networkLabel: 'ç½‘ç»œé€‰æ‹©',
          network1Label: 'æ¨è',
          network2Label: 'ä¾¿å®œ',
          network3Label: 'æ˜‚è´µ',
          rateLabel: 'æ±‡ç‡',
          feeLabel: 'æ‰‹ç»­è´¹ (0.8% + 0.2%)',
          networkFeeLabel: 'ç½‘ç»œè´¹ç”¨',
          receiveLabel: 'å®é™…æ”¶åˆ°',
          lastUpdateLabel: 'æœ€åæ›´æ–°',
          actionButton: 'ç«‹å³äº¤æ˜“',
          regulationNotice: 'æœ¬å¹³å°è‡ªåŠ¨åº”ç”¨éŸ©å›½Â·ä¸­å›½ç›‘ç®¡æ ‡å‡†',
          scenario1Desc: 'éŸ©å…ƒå…‘ç¾å…ƒ',
          scenario2Desc: 'äººæ°‘å¸å…‘ç¾å…ƒ',
          scenario3Desc: 'éŸ©å…ƒå…‘æ³°è¾¾å¸',
          scenario4Desc: 'äººæ°‘å¸å…‘æ³°è¾¾å¸',
          rateSource: 'æ±‡ç‡æ¥æºï¼šå®æ—¶å›½é™…é‡‘èå¸‚åœºæ•°æ®',
          confirmTitle: 'ç¡®è®¤äº¤æ˜“',
          confirmSubtitle: 'è¯·ç¡®è®¤ä»¥ä¸‹è¯¦æƒ…',
          confirmSendLabel: 'å‘é€é‡‘é¢',
          confirmReceiveLabel: 'æ¥æ”¶é‡‘é¢',
          confirmRateLabel: 'æ±‡ç‡',
          confirmFeeLabel: 'æ€»æ‰‹ç»­è´¹',
          cancelButton: 'å–æ¶ˆ',
          confirmButton: 'ç¡®è®¤'
        }
      };

      // Initialize
      document.addEventListener('DOMContentLoaded', () => {
        const urlParams = new URLSearchParams(window.location.search);
        const fromParam = urlParams.get('from');
        const toParam = urlParams.get('to');
        
        if (fromParam) {
          const fromSelect = document.getElementById('fromCurrency');
          if (fromSelect) fromSelect.value = fromParam.toUpperCase();
        }
        if (toParam) {
          const toSelect = document.getElementById('toCurrency');
          if (toSelect) toSelect.value = toParam.toUpperCase();
        }
        
        checkUSDTNetwork();
        loadRates();
        setupListeners();
        setInterval(loadRates, 3000);
        
        setInterval(() => {
          const badge = document.querySelector('.rate-badge');
          if (badge) {
            badge.style.transform = 'scale(1.05)';
            setTimeout(() => badge.style.transform = 'scale(1)', 200);
          }
        }, 3000);
      });

      async function loadRates() {
        try {
          const response = await axios.get('/api/rates');
          if (response.data.success) {
            currentRates = response.data.rates;
            document.getElementById('lastUpdateTime').textContent = 
              new Date(response.data.timestamp).toLocaleTimeString();
            calculate();
          }
        } catch (error) {
          console.error('Failed to load rates:', error);
        }
      }

      function setupListeners() {
        document.getElementById('fromAmount').addEventListener('input', calculate);
        document.getElementById('fromCurrency').addEventListener('change', () => {
          checkUSDTNetwork();
          calculate();
        });
        document.getElementById('toCurrency').addEventListener('change', () => {
          checkUSDTNetwork();
          calculate();
        });

        document.getElementById('globalLang').addEventListener('change', (e) => {
          changeLanguage(e.target.value);
        });
      }

      function checkUSDTNetwork() {
        const toCurrency = document.getElementById('toCurrency').value;
        const networkSection = document.getElementById('networkSection');
        const networkFeeRow = document.getElementById('networkFeeRow');
        
        if (toCurrency === 'USDT') {
          networkSection.classList.remove('hidden');
          networkFeeRow.classList.remove('hidden');
        } else {
          networkSection.classList.add('hidden');
          networkFeeRow.classList.add('hidden');
        }
      }

      function selectNetwork(network) {
        selectedNetwork = network;
        document.querySelectorAll('.network-option').forEach(el => {
          el.classList.remove('selected');
        });
        document.querySelector(`[data-network="${network}"]`).classList.add('selected');
        calculate();
      }

      async function calculate() {
        const amount = parseFloat(document.getElementById('fromAmount').value);
        const fromCurrency = document.getElementById('fromCurrency').value;
        const toCurrency = document.getElementById('toCurrency').value;

        if (!amount || amount <= 0) return;

        try {
          const response = await axios.post('/api/exchange/calculate', {
            amount,
            fromCurrency,
            toCurrency,
            network: toCurrency === 'USDT' ? selectedNetwork : null
          });

          if (response.data.success) {
            calculationResult = response.data;
            displayCalculation(response.data);
          }
        } catch (error) {
          console.error('Calculation failed:', error);
        }
      }

      function displayCalculation(data) {
        const calc = data.calculation;
        const limits = data.limits;

        const rateElement = document.getElementById('rateValue');
        const newRate = calc.exchangeRate.toFixed(6);
        if (rateElement.textContent && rateElement.textContent !== newRate) {
          rateElement.style.color = '#16a34a';
          rateElement.style.fontWeight = 'bold';
          setTimeout(() => {
            rateElement.style.color = '';
            rateElement.style.fontWeight = '';
          }, 800);
        }
        rateElement.textContent = newRate;

        document.getElementById('feeValue').textContent = 
          `${calc.totalFee.toLocaleString()} ${calc.fromCurrency}`;
        
        if (calc.network) {
          document.getElementById('networkFeeValue').textContent = `~$${calc.networkFeeUSD}`;
        }
        
        document.getElementById('receiveValue').textContent = 
          `${calc.receivedAmount.toFixed(2)} ${calc.toCurrency}`;

        const lang = document.getElementById('globalLang').value;
        const limitsTextMap = {
          ko: `ê±°ë˜ í•œë„: ìµœì†Œ ${limits.min.toLocaleString()} ${limits.currency} ~ ìµœëŒ€ ${limits.max.toLocaleString()} ${limits.currency} (ì¼ì¼ ${limits.daily.toLocaleString()} ${limits.currency})`,
          en: `Limits: Min ${limits.min.toLocaleString()} ${limits.currency} ~ Max ${limits.max.toLocaleString()} ${limits.currency} (Daily ${limits.daily.toLocaleString()} ${limits.currency})`,
          zh: `äº¤æ˜“é™é¢ï¼šæœ€ä½ ${limits.min.toLocaleString()} ${limits.currency} ~ æœ€é«˜ ${limits.max.toLocaleString()} ${limits.currency} (æ¯æ—¥ ${limits.daily.toLocaleString()} ${limits.currency})`
        };
        document.getElementById('limitsText').textContent = limitsTextMap[lang];
      }

      function swapCurrencies() {
        const fromCurrency = document.getElementById('fromCurrency');
        const toCurrency = document.getElementById('toCurrency');
        
        const temp = fromCurrency.value;
        fromCurrency.value = toCurrency.value;
        toCurrency.value = temp;
        
        checkUSDTNetwork();
        calculate();
      }

      function quickScenario(from, to) {
        document.getElementById('fromCurrency').value = from;
        document.getElementById('toCurrency').value = to;
        checkUSDTNetwork();
        calculate();
      }

      function showConfirmation() {
        if (!calculationResult) {
          const lang = document.getElementById('globalLang').value;
          const alertMsg = {
            ko: 'ê³„ì‚° ê²°ê³¼ë¥¼ ë¨¼ì € í™•ì¸í•´ì£¼ì„¸ìš”',
            en: 'Please calculate first',
            zh: 'è¯·å…ˆè®¡ç®—'
          };
          alert(alertMsg[lang]);
          return;
        }

        const calc = calculationResult.calculation;
        document.getElementById('confirmSendAmount').textContent = 
          `${calc.amount.toLocaleString()} ${calc.fromCurrency}`;
        document.getElementById('confirmReceiveAmount').textContent = 
          `${calc.receivedAmount.toFixed(2)} ${calc.toCurrency}`;
        document.getElementById('confirmRate').textContent = calc.exchangeRate.toFixed(6);
        document.getElementById('confirmFee').textContent = 
          `${calc.totalFee.toLocaleString()} ${calc.fromCurrency}`;

        document.getElementById('confirmModal').classList.remove('hidden');
        document.getElementById('confirmModal').classList.add('flex');
      }

      function closeConfirmation() {
        document.getElementById('confirmModal').classList.add('hidden');
        document.getElementById('confirmModal').classList.remove('flex');
      }

      function executeTransaction() {
        const lang = document.getElementById('globalLang').value;
        const msg = {
          ko: 'ê±°ë˜ ê¸°ëŠ¥ì€ ì¶”í›„ êµ¬í˜„ë©ë‹ˆë‹¤. í˜„ì¬ëŠ” ë°ëª¨ ë²„ì „ì…ë‹ˆë‹¤.',
          en: 'Transaction feature coming soon. This is a demo version.',
          zh: 'äº¤æ˜“åŠŸèƒ½å³å°†æ¨å‡ºã€‚è¿™æ˜¯æ¼”ç¤ºç‰ˆæœ¬ã€‚'
        };
        alert(msg[lang]);
        closeConfirmation();
      }

      function changeLanguage(lang) {
        const trans = translations[lang];
        Object.keys(trans).forEach(key => {
          const element = document.getElementById(key);
          if (element) {
            element.textContent = trans[key];
          }
        });

        // Update currency select options
        const toCurrency = document.getElementById('toCurrency');
        Array.from(toCurrency.options).forEach(option => {
          const text = option.getAttribute(`data-${lang}`);
          if (text) option.textContent = text;
        });

        // Update limits text
        if (calculationResult && calculationResult.limits) {
          const limits = calculationResult.limits;
          const limitsTextMap = {
            ko: `ê±°ë˜ í•œë„: ìµœì†Œ ${limits.min.toLocaleString()} ${limits.currency} ~ ìµœëŒ€ ${limits.max.toLocaleString()} ${limits.currency} (ì¼ì¼ ${limits.daily.toLocaleString()} ${limits.currency})`,
            en: `Limits: Min ${limits.min.toLocaleString()} ${limits.currency} ~ Max ${limits.max.toLocaleString()} ${limits.currency} (Daily ${limits.daily.toLocaleString()} ${limits.currency})`,
            zh: `äº¤æ˜“é™é¢ï¼šæœ€ä½ ${limits.min.toLocaleString()} ${limits.currency} ~ æœ€é«˜ ${limits.max.toLocaleString()} ${limits.currency} (æ¯æ—¥ ${limits.daily.toLocaleString()} ${limits.currency})`
          };
          document.getElementById('limitsText').textContent = limitsTextMap[lang];
        }
      }
    </script>
</body>
</html>
